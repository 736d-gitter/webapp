#!/bin/bash

set -x
set -e

git clone git@github.com:transloadit/jquery-sdk.git
cd jquery-sdk
grep -v 'call compile_js' Makefile > Makefile.tmp
mv Makefile.tmp Makefile
rm js/dep/json2.js
rm js/dep/jquery.easing.js
make
(echo "
var jQuery = require('jquery');
require('jquery.easing')(jQuery);
"; cat build/jquery.transloadit2-latest.js) | sed -e 's/window\.jQuery/jQuery/' > build/jquery.transloadit2-latest.js.tmp
cd ..
cp jquery-sdk/build/jquery.transloadit2-latest.js.tmp ../public/repo/transloadit/jquery.transloadit2-v2-latest.js
rm -rf jquery-sdk
