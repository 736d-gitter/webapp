neo4j:
  image: kbastani/docker-neo4j
  restart: 'always'
  ports:
    - "7474:7474"

redis1:
  image: hpess/redis
  restart: 'always'
  hostname: redis1
  net: host
  ports:
    - "6379:6379"

redis2:
  image: hpess/redis
  restart: 'always'
  hostname: redis2
  net: host
  ports:
    - "6380:6380"
  volumes:
    - ./config/redis-docker:/redis
  entrypoint: [ "/usr/local/bin/redis-server", "/redis/slave.conf", "--port", "6380"]

  # links:
  #   - 'redis1'

sentinel1:
  image: hpess/redis
  restart: 'on-failure:5'
  hostname: sentinel1
  net: host
  environment:
    master_name: 'gitter-master-dev'
    ## This is horrible but it's the only way to expose the external ip within sentinel
    master_ip: 'gitter-dev.local'
  extra_hosts:
     - "somehost:162.242.195.82"
  volumes:
    - ./config/redis-docker:/redis
  ports:
    - "26379:26379"
  entrypoint: [ "/usr/local/bin/redis-server", "/redis/redis-sentinel.conf", "--sentinel"]

  # links:
  #   - 'redis1'

mongo2:
  hostname: mongo2
  image: mongo:3.0
  restart: 'always'
  entrypoint: [ "/usr/bin/mongod", "--replSet", "troupeSet", "--journal", "--smallfiles", "--storageEngine=wiredTiger", "--oplogSize=20" ]
  ports:
    - "27018:27017"

mongo3:
  hostname: mongo3
  image: mongo:3.0
  restart: 'always'
  entrypoint: [ "/usr/bin/mongod", "--replSet", "troupeSet", "--journal", "--smallfiles", "--storageEngine=wiredTiger", "--oplogSize=20" ]
  ports:
    - "27019:27017"

mongo1:
  hostname: mongo1
  image: mongo:3.0
  restart: 'always'
  entrypoint: [ "/usr/bin/mongod", "--replSet", "troupeSet", "--journal", "--smallfiles", "--storageEngine=wiredTiger", "--oplogSize=20" ]
  ports:
    - "27017:27017"
  links:
    - mongo2:mongo2
    - mongo3:mongo3

mongosetup:
  image: mongo:3.0
  restart: no
  links:
    - mongo1:mongo1
    - mongo2:mongo2
    - mongo3:mongo3
  volumes:
    - ./config/mongo-docker:/mongo-docker
    - ./scripts:/scripts
  entrypoint: [ "/bin/bash", "/mongo-docker/init-mongo.sh" ]

# The official elasticsearch:1.4.2 image with mapper-attachments and river-mongodb plugins
# https://github.com/soldotno/elasticsearch-river-mongodb/blob/master/Dockerfile
elasticsearch:
  image: stabenfeldt/elasticsearch-river-mongodb
  ports:
    - "9200:9200"
    - "9300:9300"
  links:
    - mongo1:mongo1
    - mongo2:mongo2
    - mongo3:mongo3

elasticsearchsetup:
  image: node:0.10.39
  restart: no
  links:
    - mongo1:mongo1
    - mongo2:mongo2
    - mongo3:mongo3
    - elasticsearch:elasticsearch
  volumes:
    - ./scripts:/scripts
  entrypoint: [ "/scripts/elasticsearch/setup-docker-elasticsearch.sh" ]
